import express from 'express'
import { db, initDB } from "./db.mjs"

const app = express()
const port = 8080
app.set('view engine', 'ejs');

initDB()

app.get('/', (req, res) => {
    const keyword = req.query.keyword || ''
    const tasks = []

    db.all(`SELECT name FROM tasks
        WHERE name NOT LIKE "INFORSECIU{%" AND name LIKE "%${keyword}%";`,
        (_, rows) => {
            res.render('index', {
                keyword,
                tasks: rows.map(row => row.name),
            })
        },
    )
})

app.listen(port, () => {
    console.log(`Listening on port ${port}`)
})
